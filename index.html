<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n l√Ω chi ti√™u</title>
  <style>
    body {
      font-family: Arial;
      padding: 15px;
      max-width: 500px;
      margin: auto;
    }

    input,
    button,
    select {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      font-size: 16px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    th {
      background: #f2f2f2;
    }

    .total {
      margin-top: 10px;
      font-weight: bold;
      font-size: 18px;
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
</head>

<body>
  <h2>üìä Qu·∫£n l√Ω chi ti√™u</h2>
  <h4>Ch·ªã Nh∆∞ nu√¥i H∆∞ng H∆∞ng</h4>

  <select id="user">
    <option value="nhu">Ch·ªã Nh∆∞</option>
    <option value="hung">H∆∞ng</option>
  </select>

  <input type="number" id="money" placeholder="Nh·∫≠p s·ªë ti·ªÅn (VD: 50000)" />
  <input type="text" id="note" placeholder="N·ªôi dung chi ti√™u" />
  <button onclick="addExpense()">‚ûï Th√™m</button>

  <table>
    <thead>
      <tr>
        <th>STT</th>
        <th>S·ªë ti·ªÅn</th>
        <th>N·ªôi dung</th>
      </tr>
    </thead>
    <tbody id="table"></tbody>
  </table>

  <div class="total">
    T·ªïng ti·ªÅn: <span id="total">0</span> ƒë
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCa3r0r2qJ4eDt_QAltXaY3sPXn_cBdrZU",
      authDomain: "chi-tieu-49fe5.firebaseapp.com",
      projectId: "chi-tieu-49fe5",
      storageBucket: "chi-tieu-49fe5.appspot.com",
      messagingSenderId: "1018225594634",
      appId: "1:1018225594634:web:0220af13e0c050aaab2af3",
      measurementId: "G-8X0HQQYJNH"
    };

    // Kh·ªüi t·∫°o Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Th√™m chi ti√™u
    function addExpense() {
      const user = document.getElementById("user").value;
      const money = Number(document.getElementById("money").value);
      const note = document.getElementById("note").value;

      if (money <= 0 || note === "") {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        return;
      }

      db.collection("expenses").add({
        user: user,
        money: money,
        note: note,
        createdAt: new Date()
      });

      document.getElementById("money").value = "";
      document.getElementById("note").value = "";
    }

    // Hi·ªÉn th·ªã d·ªØ li·ªáu realtime
    const userSelect = document.getElementById("user");
    userSelect.addEventListener("change", () => {
      loadExpenses(userSelect.value);
    });

    function loadExpenses(user) {
      db.collection("expenses")
        .where("user", "==", user)
        .orderBy("createdAt")
        .onSnapshot(snapshot => {
          let table = document.getElementById("table");
          table.innerHTML = "";
          let total = 0;

          snapshot.forEach((doc, index) => {
            const e = doc.data();
            total += e.money;
            table.innerHTML += `
              <tr>
                <td>${index + 1}</td>
                <td>${e.money.toLocaleString()}</td>
                <td>${e.note}</td>
              </tr>
            `;
          });

          document.getElementById("total").innerText = total.toLocaleString();
        });
    }

    // T·∫£i d·ªØ li·ªáu ban ƒë·∫ßu
    loadExpenses(userSelect.value);
  </script>
</body>

</html>
